<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<script>
var mainwindow=null;
var msgfunction={};


function sendmsg(req,obj){
        if (mainwindow){
                document.body.classList.remove('idle');
                mainwindow.postMessage({method:req,params:obj},'*');
        }else{
                document.body.classList.add('idle');
                console.log('mainwindow not defined');
        }
}

function verifypasswd(el){
	var user=document.getElementById('user');
	var passwd=document.getElementById('passwd');
	if (mainwindow)
		sendmsg('verifypasswd',{user:user.value,passwd:passwd.value});
}

window.onmessage=function(e){
	if (window.location.origin!=e.origin){
		var response=e.data.content.response;
		if (msgfunction.hasOwnProperty(response)){
			(msgfunction[response].onmessage)(msgfunction[response].elemid,e.data.content.data);
		}else{
			mainwindow=e.source;
			console.log('message from external iframe:',e.data.content);
			var but=document.getElementById('loginbutton');
			but.style.opacity=1;
		}
	}
};
</script>
<link/>

<title>Login page</title>
</head>
<body >

<div class="header">

</div>

<div class="cantainer">
<!-- to do with fingerprint app -->
<!-- get index.html, 
	generate rsa private/public key,
	generate qrcode with public key, auth portal,
   scan with iphone app, 
   sign with fingerprint and send authentication to couchdb.
   Public key, until new session, will be authenticated,
   push access granted and redirect to portalselect.html with publickey in header  -->
   
<!--<form action="">-->
	<p class="loginname">
		Name:<input type='text' id='user' name='name'>
	</p>
	<p class="loginpasswd">
		Passwd:<input type='password' id='passwd' name='password'>
	</p>
	<!--  <keygen name="key" keytype="rsa"> -->
	<p class="loginsubmit">
		<button style='opacity:0' id='loginbutton' onclick='verifypasswd(this)' type='button'>login</button>
	</p>
<!--</form>-->
</div>


<div class="footer">
</div>

</body>
</html>
